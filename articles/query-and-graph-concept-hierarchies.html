<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>query-and-graph-concept-hierarchies • omopcept</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="query-and-graph-concept-hierarchies">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">omopcept</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.6.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/drug-classes.html">Getting drug classes from the OMOP hierarchy</a></li>
    <li><a class="dropdown-item" href="../articles/getting-omop-concept-data.html">getting-omop-concept-data</a></li>
    <li><a class="dropdown-item" href="../articles/hierarchy-for-blood-counts.html">Exploring OMOP hierarchy for blood counts</a></li>
    <li><a class="dropdown-item" href="../articles/query-and-graph-concept-hierarchies.html">query-and-graph-concept-hierarchies</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/SAFEHR-data/omopcept/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>query-and-graph-concept-hierarchies</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/SAFEHR-data/omopcept/blob/master/vignettes/query-and-graph-concept-hierarchies.Rmd" class="external-link"><code>vignettes/query-and-graph-concept-hierarchies.Rmd</code></a></small>
      <div class="d-none name"><code>query-and-graph-concept-hierarchies.Rmd</code></div>
    </div>

    
    
<p>In this vignette we will step through the process of querying the
OMOP standard vocabularies to get a list of concepts and then visualise
the relationship between those concepts.</p>
<p>By default this will use the vocabulary tables that we have saved in
the cloud (see the readme). You can repeat with vocabularies that you
have downloaded yourself but you may get different results if you have
selected different vocabularies.</p>
<p>Getting started, install from github if you haven’t already &amp; use
library().</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#remotes::install_github("SAFEHR-data/omopcept")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://SAFEHR-data.github.io/omopcept/" class="external-link">omopcept</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="example-1---query-relations-of-a-concept-and-visualise">Example 1 - query relations of a concept and visualise<a class="anchor" aria-label="anchor" href="#example-1---query-relations-of-a-concept-and-visualise"></a>
</h3>
<p>Here we find a single SNOMED concept, search for it’s relations and
the relations of those (nsteps=2) and create a graph of the
hierarchy.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">sharp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/omop_names.html">omop_names</a></span><span class="op">(</span><span class="st">"Accident caused by sharp-edged object"</span>, standard<span class="op">=</span><span class="st">"S"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">relations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/omop_relations.html">omop_relations</a></span><span class="op">(</span><span class="va">sharp</span><span class="op">$</span><span class="va">concept_id</span>, </span>
<span>                            r_ids<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Is a'</span>,<span class="st">'Subsumes'</span><span class="op">)</span>, </span>
<span>                            nsteps<span class="op">=</span><span class="fl">2</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># nodetxtsize made small to make plot visible in vignette, default=9 fine outside</span></span>
<span><span class="fu"><a href="../reference/omop_graph.html">omop_graph</a></span><span class="op">(</span><span class="va">relations</span>, saveplot<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>           graphtitle<span class="op">=</span><span class="cn">NULL</span>, legendshow<span class="op">=</span><span class="cn">FALSE</span>, nodetxtsize<span class="op">=</span><span class="fl">1</span>, textcolourvar<span class="op">=</span><span class="st">"step"</span><span class="op">)</span></span></code></pre></div>
<p><img src="query-and-graph-concept-hierarchies_files/figure-html/omop_graph-1.png" width="100%" height="100%"></p>
<p>In this case the relations were all from one domain so that is why we
didn’t need to show the legend.</p>
</div>
<div class="section level3">
<h3 id="example-2-a-tree-plot-for-cancer-staging-data">Example 2 a tree plot for cancer staging data<a class="anchor" aria-label="anchor" href="#example-2-a-tree-plot-for-cancer-staging-data"></a>
</h3>
<p>AJCC (American Joint Committee on Cancer) has a hierarchical staging
classification with different versions. All are represented in OMOP
Cancer Modifiers.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">ajcc8</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/omop_names.html">omop_names</a></span><span class="op">(</span><span class="st">"AJCC/UICC 8th edition"</span>, exact<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ajcc_rel1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/omop_relations.html">omop_relations</a></span><span class="op">(</span><span class="va">ajcc8</span><span class="op">$</span><span class="va">concept_id</span>, nsteps<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#TODO find a quicker example of getting more than one relations step</span></span>
<span></span>
<span><span class="co"># getting recursive relations takes a few minutes</span></span>
<span><span class="co">#ajcc_rel2 &lt;- omop_relations(ajcc8$concept_id, nsteps=2)</span></span>
<span></span>
<span><span class="co"># plot is too big to display nicely in this vignette</span></span>
<span><span class="co"># but is auto saved in a nice to pdf</span></span>
<span><span class="co"># omop_graph(ajcc_rel1, ggrlayout="tree", </span></span>
<span><span class="co">#            legendshow = FALSE, saveplot = TRUE, </span></span>
<span><span class="co">#            width = 150, nodetxtangle = 45)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Andy South.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
